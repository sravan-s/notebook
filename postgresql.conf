# -----------------------------
# PostgreSQL Configuration File
# -----------------------------

# Server Settings
listen_addresses = 'localhost'  # Listen only on localhost (change to '*' to listen on all interfaces)
port = 5432                     # Default port for PostgreSQL

# Memory Settings
shared_buffers = 256MB          # Memory dedicated to the buffer cache
work_mem = 64MB                 # Memory for sorting and hashing operations per session
maintenance_work_mem = 128MB    # Memory for maintenance tasks like VACUUM, CREATE INDEX, etc.

# Connection Settings
max_connections = 100           # Maximum number of connections to the database
superuser_reserved_connections = 3  # Reserved connections for superuser

# Logging Settings
logging_collector = on          # Enable logging to files
log_directory = 'log'           # Directory where log files will be stored
log_filename = 'postgresql-%Y-%m-%d.log'  # Log filename pattern
log_rotation_age = 1d           # Rotate log files daily
log_rotation_size = 10MB        # Rotate log files when they reach 10MB


# Authentication and Security
password_encryption = scram-sha-256  # Use SCRAM-SHA-256 for password encryption

# Resource Usage
max_worker_processes = 8        # Maximum number of background worker processes
max_parallel_workers = 4        # Maximum number of parallel workers for query execution
max_parallel_workers_per_gather = 2  # Maximum number of workers for a single parallel query

# Autovacuum
autovacuum = on                  # Enable autovacuuming
autovacuum_naptime = 1min        # Time between autovacuum runs
autovacuum_vacuum_scale_factor = 0.2  # Threshold for vacuum based on table size
autovacuum_analyze_scale_factor = 0.1  # Threshold for analyze based on table size

# Data Storage
data_directory = './data'  # Data directory (ensure this path exists)
hba_file = './data/pg_hba.conf'  # Path to the HBA file
ident_file = './data/pg_ident.conf'  # Path to the ident file

# Client Connection Defaults
client_encoding = 'UTF8'         # Default client encoding
default_transaction_isolation = 'read committed'  # Default transaction isolation level
timezone = 'UTC'                 # Default timezone

# Statement Behavior
statement_timeout = 0            # Set to 0 for no timeout
idle_in_transaction_session_timeout = 0  # Set to 0 for no timeout

# Background Writer
bgwriter_delay = 200ms           # Delay between background writer checks
bgwriter_lru_maxpages = 100      # Maximum number of LRU pages to write per round

# Checkpoints
checkpoint_timeout = 5min        # Maximum time between checkpoints
checkpoint_completion_target = 0.7  # Target percentage of checkpoint interval to be spent on checkpoints

# WAL (Write-Ahead Logging)
wal_level = replica              # Level of WAL logging (use 'minimal' for faster performance, 'replica' for replication)
max_wal_size = 1GB               # Maximum size of WAL files
min_wal_size = 80MB              # Minimum size of WAL files
wal_compression = on             # Enable WAL compression

# Replication
max_wal_senders = 10             # Maximum number of WAL sender processes
wal_keep_size = 512MB            # Size of WAL files to retain for standby servers
